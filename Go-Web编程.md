# 第一章 Go与Web应用

阐述Go用于开发Web应用的优势，以及介绍HTTP协议、Web应用等关键概念。

## Go基础优势

Go本身的基础优势：

- 提供过程式编程的特性，也支持函数式编程的特性
- 内置对并发编程的支持
- 现代化的包管理系统
- 现代化的垃圾收集特性
- 强大的标准库

## Web应用特性

一个大规模扩拓展的Web应用具备的特性：

- 可拓展
- 模块化
- 可维护
- 高性能

那么Go在满足这些特性上有何优势？

### 可拓展

可拓展，意味着可以通过简单、快速地提升应用的性能以便处理更多的请求。有两种方式可以对性能进行拓展。

- 垂直拓展。提升单台设备的CPU数量或者性能。
- 水平拓展。通过增加计算机数量提升性能。

在垂直拓展上，Go拥有非常优异的并发编程支持，只需要一个操作系统线程，就可以通过调度来高效运行数十万个goroutine。

在水平拓展上，Go也可以通过在多个Web应用之上架设代理来进行高效的水平拓展。同时，因为Go Web应用会被编译成不包含任何动态依赖关系的静态二进制文件，所以可以将其安装到没有安装Go语言的系统里，以简单一致的方式部署应用。

### 模块化

Web应用由可替换的组件组成，这样做使开发者更容易修改。另一个好处是可以通过复用模块化的组件来降低软件开发所需的费用。

Go可以通过接口机制来实现动态类型匹配，用以模块化。同时，Go还支持函数式编程常见的特性，比如使用函数作为值、闭包，这些特性能允许开发者使用已有的函数来构建新的函数，从而构建出更模块化的代码。

### 可维护

Go的设计鼓励良好的软件工程实践，拥有简洁且极具可读性的语法以及灵活且清晰的包管理系统。它具有一整套优秀的工具，比如go fmt可以格式化代码，go doc可以管理注释文档，go test可以进行测试。Go还提供了Web应用测试工具，可以模拟出一个Web服务器，对该服务器生成的响应进行记录。

### 高性能

高性能意味着不仅能够在短时间内处理大量请求，还意味着能够快速地对客户端进行响应。

Go语言的一个设计目标是提供接近于C语言的性能，具有非常优秀的性能。Go程序会被编译成本地码(native code)，意味着比解释型语言要快。同时，goroutne对并发编程提供了非常好的支持。

## Web应用的定义

web服务器：监视特定的目录，在接收到请求时返回位于目录中的文件。比如httpd, Apache。

web应用：会对请求进行处理，并执行应用程序中预先设定好的操作，然后返回文件/结果。

web服务器是静态的，web应用是动态的，可以将web服务器理解成是特殊的web应用。

本文的web应用定义，需要满足两个要求。第一，必须向发送命令请求的客户端返回HTML，客户端则会向用户展示渲染后的HTML。第二，向客户端传送数据时必须使用HTTP协议。

web服务：若向客户端返回的不是HTML，而是其他格式的数据，就认为是web服务。

## Web应用的诞生

Web服务器一开始只处理静态HTML，后来也包含动态生成的内容。

通用网关接口（Common Gateway Interface, CGI）是早起尝试动态生成HTML内容的技术之一。

CGI是一个简单的接口，它允许Web服务器与一个独立运行于Web服务器进程之外的进程进行对接。通过CGI与服务器进行对接的程序通常被称为CGI程序，这种程序可以使用任何编程语言编写，这也是被称为"通用"接口的原因。向CGI程序传递输入参数是通过设置环境变量来完成的，CGI程序在运行之后还将向标准输出返回结果，而服务器则会将这些结果传送至客户端。

与CGI同期出现的还有服务端包含(server-side includes, SSI)技术。这种技术允许开发者在HTML文件中包含一些指令，当客户端请求一个HTML文件时，服务端在返回这个文件之前，会先执行文件中包含的指令，并将文件中出现的指令的位置替换成这些指令的执行结果。SSI最常见的用法是在HTML文件中包含其他被频繁使用的文件，又或者将整个网站都会出现的页面首部以及尾部的代码嵌入HTML文件中。SSI演化的最终结果就是在HTML里面包含更为复杂的代码，并使用更强大的解释器，由此衍生出了PHP、ASP、JSP等一系列非常成功的引擎。

## HTTP请求

安全：如果一个HTTP方法只要求服务器提供信息而不会对服务器的状态做任何修改，那么这个方法就是安全的。GET、HEAD、OPTIONS和TRACE都是安全的，而POST、PUT和DELETE不是安全的。

幂等：如果一个HTTP方法在使用相同的数据进行第二次调用的时候，不会对服务器的状态造成任何改变，那么这个方法就是幂等的。根据安全的方法的定义，可知安全的方法是天生幂等的。PUT和DELETE虽然不安全，但却是幂等的，这是因为第二次调用时不会修改服务器的状态。需要注意的是，服务器报错并意味着不幂等，比如多次DELETE一个资源，可能会报错，但是服务器的状态不变，它就是幂等的。因为POST请求是否会改变服务器状态是由服务器决定的，所以POST方法既不安全也非幂等。

浏览器对请求方法的支持：GET方法是最基本的方法，所有浏览器都支持。POST方法从HTML 2.0开始可以通过添加HTML表单来实现，但HTML不支持GET和POST之外的其他方法。浏览器除了支持HTML，还支持XHR(XMLHttpRequest)，以提供对PUT方法和DELETE方法的支持。XHR是一系列浏览器API，这些API通常由JavaScript包裹，实际上XHR是一个名为XMLHttpRequest的浏览器对象。XHR允许程序员向浏览器放HTTP请求，它并不如它的名字所暗示那样局限于XML，还支持JSON、纯文本等任何格式的数据。

## Web应用的组成部分

web应用有以下任务：

1. 通过HTTP协议，以HTTP请求报文的形式获取客户端输入
2. 对HTTP请求报文进行处理，并执行必要的操作
3. 生成HTML，并以HTTP响应报文的形式将其返回给客户端

为了完成这些任务，Web应用分成了处理器(handler)和模板引擎(template engine)。

### 处理器

处理器用于接受和处理客户端发来的请求，然后调用模板引擎生成HTML并把数据填充回传到客户端的响应报文中。用MVC(Model-View-Controller)模式来讲，处理器既是控制器(Controller)又是模型(Model)。

### 模板引擎

模板引擎通过模板和数据来生成返回给客户端的HTML，它是由早起的SSI技术演变而来的。

模板引擎可以分为静态模板和动态模板。

静态模板是一种夹杂着占位符的HTML，静态模板引擎通过将静态模板中的占位符替换成相应的数据来生成最终的HTML。静态逻辑通常不包含任何逻辑代码，因此被称为无逻辑模板。CTemplate和Mustache属于静态模板引擎。

动态模板除了包含HTML和占位符之外，还包含一些编程语言结构，如条件语句、迭代语句和变量。JSP(JavaServer Pages), ASP(Active Server Pages)属于动态模板引擎。PHP刚诞生时看上去也像是一种动态模板，后来才逐渐发展成为一门编程语言。

# 第二章 例子展示

展示如何使用Go构件一个典型的Web应用。



# 第三章 接收请求

详细展示使用net/http包接收HTTP请求的方法。读者将学会如何编程Go Web服务器监听HTTP请求，以及如何使用处理器和处理器函数处理这些请求。



# 第四章 处理请求

介绍处理HTTP请求的相关细节，重点讲述Go是如何处理请求并返回响应的。除此之外，读者还将学会如何从HTML表单中获取数据以及如何使用cookie。



# 第五章 内容展示

介绍Go模板引擎，包括text/template库和html/template库。读者将会看到Go提供的各种模板机制，并学会如何使用Go的布局。



# 第六章 存储数据

介绍Go的存储策略。读者将学会如何将数据存储到内存，以及将数据存储到文件系统。



# 第七章 构建Web服务的方法

介绍构件Web服务的方法，以及处理XML、JSON数据的方法。



# 第八章 应用测试

介绍不同层级的测试方法，包括单元测试、基准测试以及HTTP测试，还简单介绍了几个第三方测试库。



# 第九章 并发

介绍并发特性，学会如何利用并发特性来提高性能。



# 第十章 部署

介绍Web应用的部署方法，包括部署到独立的服务器上、云平台、Docker等。